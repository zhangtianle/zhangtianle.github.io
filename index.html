<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>keep moving</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="keep moving">
<meta property="og:url" content="/index.html">
<meta property="og:site_name" content="keep moving">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="keep moving">
<meta name="twitter:description">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  
    
    
  
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="/img/myTitle.png" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Tianle Zhang</a></h1>
		</hgroup>

		
				


		

		<div id="switch-area" class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives/">所有文章</a></li>
				        
							<li><a href="/about/">关于我</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<ul class="social">
							
								<li id="Email"><a class="Email" target="_blank" href="mailto:cqtianle@163.com" title="Email"></a></li>
					        
								<li id="GitHub"><a class="GitHub" target="_blank" href="https://github.com/zhangtianle" title="GitHub"></a></li>
					        
						</ul>
					</nav>
				</section>
				
				
				
				

				
				
				<section class="switch-part switch-part3">
				
					<div id="js-aboutme">南山小马</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">Tianle Zhang</a></h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<a href="/" class="profilepic">
				<img lazy-src="/img/myTitle.png" class="js-avatar">
			</a>
			<hgroup>
			  <h1 class="header-author"><a href="/" title="回到主页">Tianle Zhang</a></h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives/">所有文章</a></li>
		        
					<li><a href="/about/">关于我</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
						<ul class="social">
							
								<li id="Email"><a class="Email" target="_blank" href="mailto:cqtianle@163.com" title="Email"></a></li>
					        
								<li id="GitHub"><a class="GitHub" target="_blank" href="https://github.com/zhangtianle" title="GitHub"></a></li>
					        
						</ul>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap">
  
    <article id="post-spring-websocket开发" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/12/17/spring-websocket开发/" class="article-date">
  	<time datetime="2015-12-17T11:44:48.000Z" itemprop="datePublished">2015-12-17</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/17/spring-websocket开发/">spring websocket开发</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="u96F6_u3001_u603B_u4F53_u4ECB_u7ECD"><a href="#u96F6_u3001_u603B_u4F53_u4ECB_u7ECD" class="headerlink" title="零、总体介绍"></a>零、总体介绍</h2><h3 id="u9879_u76EE_u80CC_u666F"><a href="#u9879_u76EE_u80CC_u666F" class="headerlink" title="项目背景"></a>项目背景</h3><p>该项目是重庆邮电大学通信软件开发实训课程的一门作业，要求完成一个聊天系统，但要求有至少一个亮点，无论是功能上的还是技术上的。<br>我们小组比较擅长Java Web开发，因此决定在技术上做一个亮点，使用WebSocket</p>
<h3 id="u6587_u6863_u8BF4_u660E"><a href="#u6587_u6863_u8BF4_u660E" class="headerlink" title="文档说明"></a>文档说明</h3><p>该文档按照如下顺序进行介绍</p>
<ol>
<li>技术背景<br>介绍该项目要用到的一些背景知识</li>
<li>项目目录结构<br>该项目使用myeclipse的Java EE项目，大体上可分为前台与后台</li>
<li>项目框架搭建<br>介绍前台用到的技术，以及后台框架的搭建</li>
<li>项目成果展示</li>
<li>代码分享</li>
</ol>
<h2 id="u4E00_u3001_u6280_u672F_u80CC_u666F"><a href="#u4E00_u3001_u6280_u672F_u80CC_u666F" class="headerlink" title="一、技术背景"></a>一、技术背景</h2><h3 id="1-WebSocket"><a href="#1-WebSocket" class="headerlink" title="1.WebSocket"></a>1.WebSocket</h3><p>WebSocket是HTML5开始提供的一种在单个 TCP 连接上进行全双工通讯的协议。WebSocket通讯协议于2011年被IETF定为标准RFC 6455，WebSocketAPI被W3C定为标准。<br>在WebSocket API中，浏览器和服务器只需要做一个握手的动作，然后，浏览器和服务器之间就形成了一条快速通道。两者之间就直接可以数据互相传送。</p>
<h3 id="2-Spring"><a href="#2-Spring" class="headerlink" title="2.Spring"></a>2.Spring</h3><p>Spring是一个开源轻量级的框架，使用控制反转（IoC）和面向切面（AOP），它可以让开发变得简单、轻便、快速与更加灵活。</p>
<h3 id="3-Spring_WebSocket"><a href="#3-Spring_WebSocket" class="headerlink" title="3.Spring WebSocket"></a>3.Spring WebSocket</h3><p>Spring从4.0开始加入了spring-websocket这个模块，并能够全面支持WebSocket，它与Java WebSocket API标准（JSR-356）保持一致，同时提供了额外的服务。</p>
<h3 id="4-Spring_MVC"><a href="#4-Spring_MVC" class="headerlink" title="4.Spring MVC"></a>4.Spring MVC</h3><p>Spring MVC是一个model-view-controller（MVC）框架，能很好地将数据、业务与展现进行分离。Spring MVC的设计是围绕DispatcherServlet展开的，DispatcherServlet负责将请求派发到特定的handler。</p>
<h3 id="5-MyBatis"><a href="#5-MyBatis" class="headerlink" title="5.MyBatis"></a>5.MyBatis</h3><p>MyBatis 是支持定制化 SQL、存储过程以及高级映射的优秀的持久层框架。MyBatis 避免了几乎所有的 JDBC 代码和手动设置参数以及获取结果集。MyBatis 可以对配置和原生Map使用简单的 XML 或注解，将接口和 Java 的 POJOs(Plain Old Java Objects,普通的 Java对象)映射成数据库中的记录。</p>
<p><strong>在本项目中，我们使用了以上几个框架进行搭建。</strong></p>
<h2 id="u4E8C_u3001_u76EE_u5F55_u7ED3_u6784"><a href="#u4E8C_u3001_u76EE_u5F55_u7ED3_u6784" class="headerlink" title="二、目录结构"></a>二、目录结构</h2><ul>
<li><p>Com.tx.<br>Config websocket配置文件<br>Controller spring mvc 控制层<br>DAO 数据库连接操作<br>Handler websocket操作<br>Model 数据实体<br>Service 服务器处理<br>Tool 工具类</p>
</li>
<li><p>Webroot<br>前台代码目录<br>Js javascript代码<br>Style css代码<br>Test 前台测试代码</p>
</li>
<li><p>WEN-INF 配置文件夹<br>Jsp jsp文件夹<br>Lib 项目所需的外部jar包<br>As-servlet.xml spring mvc 配置文件<br>Web.xml web项目配置文件</p>
</li>
</ul>
<p><img src="http://i4.tietuku.com/97e27aef6f047eabs.png" alt="目录结构"></p>
<h2 id="u4E09_u3001_u5B9E_u9A8C_u6B65_u9AA4"><a href="#u4E09_u3001_u5B9E_u9A8C_u6B65_u9AA4" class="headerlink" title="三、实验步骤"></a>三、实验步骤</h2><h3 id="web_u670D_u52A1_u524D_u7AEF"><a href="#web_u670D_u52A1_u524D_u7AEF" class="headerlink" title="web服务前端"></a>web服务前端</h3><h4 id="1_u3001socket_u76F8_u5173_u4EE3_u7801_u7ED3_u6784"><a href="#1_u3001socket_u76F8_u5173_u4EE3_u7801_u7ED3_u6784" class="headerlink" title="1、socket相关代码结构"></a>1、socket相关代码结构</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> socket = <span class="keyword">new</span> Socket(url);<span class="comment">//url必须为ws://开头的相关协议</span></span><br><span class="line">socket.onopen = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">	<span class="comment">//连接初始化代码</span></span><br><span class="line">&#125;;</span><br><span class="line">sokcet.onmessage = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> text = event.data;</span><br><span class="line">	<span class="comment">//处理接受到的消息</span></span><br><span class="line">&#125;;</span><br><span class="line">socket.onclose = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">	<span class="comment">//连接关闭时触发</span></span><br><span class="line">&#125;;</span><br><span class="line">socket.onerror = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">	<span class="comment">//连接过程中出错时触发</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-_u672C_u6B21_u5B9E_u9A8C_u6240_u5C01_u88C5_u7684_u4E00_u4E9B_u51FD_u6570_u7684_u89E3_u6790"><a href="#2-_u672C_u6B21_u5B9E_u9A8C_u6240_u5C01_u88C5_u7684_u4E00_u4E9B_u51FD_u6570_u7684_u89E3_u6790" class="headerlink" title="2.本次实验所封装的一些函数的解析"></a>2.本次实验所封装的一些函数的解析</h4><ol>
<li><p>消息封装函数，用于生成能直接添加到html的dom节点的文档类型</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">messagePackage</span>(<span class="params">message</span>) </span>&#123;</span><br><span class="line">    <span class="comment">/*</span><br><span class="line">     message&#123;</span><br><span class="line">     userName : xx,</span><br><span class="line">     timeSign : 22:12:44,</span><br><span class="line">     content : abc</span><br><span class="line">     &#125;</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">var</span> element_section = $(<span class="string">"&lt;section&gt;&lt;/section&gt;"</span>);</span><br><span class="line">    <span class="keyword">var</span> element_section_p1 = $(<span class="string">"&lt;p&gt;&lt;/p&gt;"</span>);</span><br><span class="line">    <span class="keyword">var</span> element_section_p1_user = $(<span class="string">"&lt;span&gt;&lt;/span&gt;"</span>);</span><br><span class="line">    <span class="keyword">var</span> element_section_p1_time = $(<span class="string">"&lt;time&gt;&lt;/time&gt;"</span>);</span><br><span class="line">    <span class="keyword">var</span> element_section_p2_content = $(<span class="string">"&lt;p&gt;&lt;/p&gt;"</span>);</span><br><span class="line">    element_section.addClass(<span class="string">"message"</span>);</span><br><span class="line">    element_section_p1.addClass(<span class="string">"header"</span>);</span><br><span class="line">    element_section_p2_content.addClass(<span class="string">"content"</span>);</span><br><span class="line">    element_section_p1_user.text(message.username);</span><br><span class="line">    element_section_p1_time.text(message.timeSign);</span><br><span class="line">    element_section_p2_content.text(message.content);</span><br><span class="line">    element_section_p1.append(element_section_p1_user);</span><br><span class="line">    element_section_p1.append(element_section_p1_time);</span><br><span class="line">    element_section.append(element_section_p1);</span><br><span class="line">    element_section.append(element_section_p2_content);</span><br><span class="line">    <span class="keyword">return</span> element_section;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>消息处理函数，用于处理onmessage中由服务器发送到客户端的消息，并规定了消息类型与相关的处理方式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span><br><span class="line">jsonData : &#123;</span><br><span class="line">    type:1(聊天信息)||2(用户列表更新信息),</span><br><span class="line">    username(1,2):xx,</span><br><span class="line">    timeSign(1):xx:xx:xx,</span><br><span class="line">    content(1):xxxxxxxxxxxxx,</span><br><span class="line">&#125;</span><br><span class="line"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">messageHandle</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> jsonStr = event.data;</span><br><span class="line">    <span class="keyword">var</span> data = <span class="built_in">JSON</span>.parse(jsonStr);</span><br><span class="line">    <span class="keyword">var</span> $message = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">switch</span>(data.type) &#123;</span><br><span class="line">        <span class="comment">//更新聊天显示框</span></span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">if</span>(data.username == currentUser) <span class="keyword">return</span>;</span><br><span class="line">            $message = messagePackage(&#123;</span><br><span class="line">               username : data.username,</span><br><span class="line">                timeSign : data.timeSign,</span><br><span class="line">                content : data.content</span><br><span class="line">            &#125;);</span><br><span class="line">            $show.append($message);</span><br><span class="line">            <span class="comment">//让滚动条自动滚到底</span></span><br><span class="line">            $show.get(<span class="number">0</span>).scrollTop = $show.get(<span class="number">0</span>).scrollHeight;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="comment">//向已经在线的用户发送用户列表更新信息</span></span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">var</span> $userName = $(<span class="string">"&lt;p&gt;&lt;/p&gt;"</span>);</span><br><span class="line">            $userName.text(data.username);</span><br><span class="line">            $(<span class="string">"#usersInfo"</span>).append($userName);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="comment">//将所有已经在线的用户信息发送给刚加入的用户</span></span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">            <span class="keyword">var</span> usernames = data.usernames;</span><br><span class="line">            <span class="keyword">var</span> $usersInfo = $(<span class="string">"#usersInfo"</span>);</span><br><span class="line">            $usersInfo.empty();</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">var</span> i= <span class="number">0</span>,len=usernames.length;i&lt;len;i++) &#123;</span><br><span class="line">                <span class="keyword">var</span> $userName = $(<span class="string">"&lt;p&gt;&lt;/p&gt;"</span>);</span><br><span class="line">                $userName.text(usernames[i]);</span><br><span class="line">                $usersInfo.append($userName);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="comment">//删除用户信息</span></span><br><span class="line">        <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">            <span class="keyword">var</span> $usersInfo = $(<span class="string">"#usersInfo"</span>);</span><br><span class="line">            $usersInfo.find(<span class="string">":contains("</span>+data.username+<span class="string">")"</span>).remove();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="Spring__26amp_3B_Spring_MVC_u914D_u7F6E"><a href="#Spring__26amp_3B_Spring_MVC_u914D_u7F6E" class="headerlink" title="Spring &amp; Spring MVC配置"></a>Spring &amp; Spring MVC配置</h3><h4 id="1_u3001Web-xml__u914D_u7F6E"><a href="#1_u3001Web-xml__u914D_u7F6E" class="headerlink" title="1、Web.xml 配置"></a>1、Web.xml 配置</h4><p>配置spring 过滤器 并设置UTF-8编码<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">filter</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="title">filter-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="title">filter-class</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">init-param</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="title">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="title">param-name</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="title">param-value</span>&gt;</span>utf-8<span class="tag">&lt;/<span class="title">param-value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="title">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">filter-mapping</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="title">filter-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="title">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>配置servlet spring mvc拦截器 设置匹配后缀名为.do<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">display-name</span>&gt;</span>as<span class="tag">&lt;/<span class="title">display-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">servlet</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">servlet-name</span>&gt;</span>as<span class="tag">&lt;/<span class="title">servlet-name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="title">servlet-class</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="title">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">servlet-mapping</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">servlet-name</span>&gt;</span>as<span class="tag">&lt;/<span class="title">servlet-name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">url-pattern</span>&gt;</span>*.do<span class="tag">&lt;/<span class="title">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h4 id="2-as-servlet-xml__u914D_u7F6ESpring_MVC"><a href="#2-as-servlet-xml__u914D_u7F6ESpring_MVC" class="headerlink" title="2.as-servlet.xml 配置Spring MVC"></a>2.as-servlet.xml 配置Spring MVC</h4><p>使用Spring注解的方式<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">mvc:annotation-driven</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">context:annotation-config</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">context:component-scan</span> <span class="attribute">base-package</span>=<span class="value">"com.tx.*"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">bean</span> <span class="attribute">id</span>=<span class="value">"handlerMapping"</span> <span class="attribute">class</span>=<span class="value">"org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping"</span> /&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>返回json模板<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">bean</span> <span class="attribute">class</span>=<span class="value">"org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"messageConverters"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">list</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="title">bean</span> <span class="attribute">class</span>=<span class="value">"org.springframework.http.converter.json.MappingJacksonHttpMessageConverter"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="title">list</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>设置spring mvc视图<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">bean</span> <span class="attribute">id</span>=<span class="value">"viewResolver"</span>	<span class="attribute">class</span>=<span class="value">"org.springframework.web.servlet.view.UrlBasedViewResolver"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"viewClass"</span> <span class="attribute">value</span>=<span class="value">"org.springframework.web.servlet.view.JstlView"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"prefix"</span> <span class="attribute">value</span>=<span class="value">"/WEB-INF/jsp/"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"suffix"</span> <span class="attribute">value</span>=<span class="value">".jsp"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h4 id="3-_u914D_u7F6ESpring_MVC_controller"><a href="#3-_u914D_u7F6ESpring_MVC_controller" class="headerlink" title="3.配置Spring MVC controller"></a>3.配置Spring MVC controller</h4><p>controller用于接收和发送前后台的请求与响应<br>本例以用户登录、注册为例<br>这里使用了Spring MVC注解来进行请求的处理</p>
<blockquote>
<h5 id="u4F8B_uFF1A"><a href="#u4F8B_uFF1A" class="headerlink" title="例："></a>例：</h5><p><strong>@RequestMapping</strong>里面填写的是请求的地址<br><strong>return</strong> 根据返回值的不同进行页面跳转等操作，这里返回 <strong>login</strong> 表示跳转到 <strong>login.jsp</strong> 这个页面</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@RequestMapping</span>(<span class="string">"login.do"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="function">String <span class="title">gtLogin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="string">"login"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="annotation">@RequestMapping</span>(<span class="string">"register.do"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">gtRegister</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"register"</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="annotation">@RequestMapping</span>(<span class="string">"login.do"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">gtLogin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"login"</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="annotation">@RequestMapping</span>(<span class="string">"loginServer.do"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> ModelAndView <span class="title">login</span><span class="params">(@RequestParam(<span class="string">"username"</span>)</span> String username,</span><br><span class="line">			@<span class="title">RequestParam</span><span class="params">(<span class="string">"password"</span>)</span> String password) </span>&#123;</span><br><span class="line"></span><br><span class="line">		ModelAndView modelAndView = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">		StudentService ss = <span class="keyword">new</span> StudentService();</span><br><span class="line">		<span class="keyword">boolean</span> r = ss.login(username, password);</span><br><span class="line">		<span class="keyword">if</span> (r) &#123;</span><br><span class="line">			 modelAndView.addObject(<span class="string">"name"</span>, username);</span><br><span class="line">			 modelAndView.setViewName(<span class="string">"chat"</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			modelAndView.setViewName(<span class="string">"login"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> modelAndView;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="annotation">@RequestMapping</span>(value = <span class="string">"registerServer.do"</span>, method = RequestMethod.POST)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> ModelAndView <span class="title">gtRegister</span><span class="params">(@RequestParam(<span class="string">"username"</span>)</span> String username,</span><br><span class="line">			@<span class="title">RequestParam</span><span class="params">(<span class="string">"password"</span>)</span> String password) </span>&#123;</span><br><span class="line">		StudentService ss = <span class="keyword">new</span> StudentService();</span><br><span class="line">		ModelAndView modelAndView = <span class="keyword">new</span> ModelAndView();  </span><br><span class="line">		<span class="keyword">boolean</span> r = ss.register(username, password);</span><br><span class="line">		<span class="keyword">if</span> (r) &#123;</span><br><span class="line">			 modelAndView.addObject(<span class="string">"name"</span>, username);  </span><br><span class="line">			 modelAndView.setViewName(<span class="string">"chat"</span>);  </span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			modelAndView.setViewName(<span class="string">"login"</span>);  </span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> modelAndView;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Mybatis_u914D_u7F6E"><a href="#Mybatis_u914D_u7F6E" class="headerlink" title="Mybatis配置"></a>Mybatis配置</h3><blockquote>
<p><strong>有关mybatis的具体使用说明可以参考 <em><a href="http://mybatis.org/mybatis-3/zh/" title="Title" target="_blank" rel="external">mybatis文档</a></em></strong></p>
</blockquote>
<h4 id="1-_u5EFA_u7ACB_u4E0E_u6570_u636E_u5E93_u8868_u5BF9_u5E94_u7684model_uFF0CPOJO_u7C7B"><a href="#1-_u5EFA_u7ACB_u4E0E_u6570_u636E_u5E93_u8868_u5BF9_u5E94_u7684model_uFF0CPOJO_u7C7B" class="headerlink" title="1.建立与数据库表对应的model，POJO类"></a>1.建立与数据库表对应的model，POJO类</h4><p>这里仅以Student.java类来说明:<br>类名同数据库中的表名一致，变量名同同数据库中的字段名一致，并编写get()和set()方法<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tx.model;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> password;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.password = password;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="2-mybatis-config-xml_u8BBE_u7F6E"><a href="#2-mybatis-config-xml_u8BBE_u7F6E" class="headerlink" title="2.mybatis-config.xml设置"></a>2.mybatis-config.xml设置</h4><p>我们使用xml来对mybatis数据库进行配置，里面包括：</p>
<ul>
<li>driver： 数据库驱动程序</li>
<li>url: 数据库连接地址及数据库名</li>
<li>username：数据库连接用户名</li>
<li>password：数据库连接密码</li>
</ul>
<ul>
<li>xml映射文件</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="doctype">&lt;!DOCTYPE configuration</span><br><span class="line">  PUBLIC "-//mybatis.org//DTD Config 3.0//EN"</span><br><span class="line">  "http://mybatis.org/dtd/mybatis-3-config.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="title">environments</span> <span class="attribute">default</span>=<span class="value">"development"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">environment</span> <span class="attribute">id</span>=<span class="value">"development"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">transactionManager</span> <span class="attribute">type</span>=<span class="value">"JDBC"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">dataSource</span> <span class="attribute">type</span>=<span class="value">"POOLED"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"driver"</span> <span class="attribute">value</span>=<span class="value">"com.mysql.jdbc.Driver"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"url"</span> <span class="attribute">value</span>=<span class="value">"jdbc:mysql://localhost:3306/chat"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"username"</span> <span class="attribute">value</span>=<span class="value">"root"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"password"</span> <span class="attribute">value</span>=<span class="value">"password"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="title">dataSource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">environment</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">environments</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="title">mappers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">mapper</span> <span class="attribute">resource</span>=<span class="value">"com/tx/model/mapping.xml"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">mappers</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="title">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="3-mapping-xml_u8BBE_u7F6E"><a href="#3-mapping-xml_u8BBE_u7F6E" class="headerlink" title="3.mapping.xml设置"></a>3.mapping.xml设置</h4><p>mybatis的映射表，通过写sql语句来进行查询<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="doctype">&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" </span><br><span class="line">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">mapper</span> <span class="attribute">namespace</span>=<span class="value">"com.tx.model.Mapper"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 通过username获得密码 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">select</span> <span class="attribute">id</span>=<span class="value">"getpwd"</span> <span class="attribute">parameterType</span>=<span class="value">"String"</span> <span class="attribute">resultType</span>=<span class="value">"String"</span>&gt;</span></span><br><span class="line">      select stuPassword from student where stuName=#&#123;stuName&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="title">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">insert</span> <span class="attribute">id</span>=<span class="value">"register"</span> <span class="attribute">parameterType</span>=<span class="value">"String"</span>&gt;</span></span><br><span class="line">    	insert into student (stuName, stuPassword) values (#&#123;stuName&#125;, #&#123;stuPassword&#125;) </span><br><span class="line">    <span class="tag">&lt;/<span class="title">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="title">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="DAO_u5C42_u4EE3_u7801"><a href="#DAO_u5C42_u4EE3_u7801" class="headerlink" title="DAO层代码"></a>DAO层代码</h3><p> mybatis的映射文件，方法名与xml中的id相同<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tx.model;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Param;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Mapper</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getpwd</span><span class="params">(String stuName)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">register</span><span class="params">(@Param(<span class="string">"stuName"</span>)</span>String stuName, @<span class="title">Param</span><span class="params">(<span class="string">"stuPassword"</span>)</span>String stuPassword)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>DAO层，调用Mybatis的Mapper接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tx.DAO;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.tx.model.Mapper;</span><br><span class="line"><span class="keyword">import</span> com.tx.tools.Helper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentDAO</span> </span>&#123;</span><br><span class="line">	SqlSession session = Helper.getSessionFactory().openSession();</span><br><span class="line">	Mapper mapper = session.getMapper(Mapper.class);</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getpwd</span><span class="params">(String username)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> mapper.getpwd(username);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">register</span><span class="params">(String name, String password)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> result = <span class="number">0</span>;</span><br><span class="line">		SqlSession session = Helper.getSessionFactory().openSession();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Mapper mapper = session.getMapper(Mapper.class);</span><br><span class="line">			result = mapper.register(name, password);</span><br><span class="line">			session.commit();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			session.close();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="service_u5C42_u4EE3_u7801"><a href="#service_u5C42_u4EE3_u7801" class="headerlink" title="service层代码"></a>service层代码</h3><p>service层调用DAO层<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tx.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.tx.DAO.StudentDAO;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	StudentDAO sdao = <span class="keyword">new</span> StudentDAO();</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">login</span><span class="params">(String name, String password)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">boolean</span> result = <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (password.equals(sdao.getpwd(name))) &#123;</span><br><span class="line">			result = <span class="keyword">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">register</span><span class="params">(String name, String password)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(sdao.register(name, password) == <span class="number">1</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="Spring_websocket_u914D_u7F6E"><a href="#Spring_websocket_u914D_u7F6E" class="headerlink" title="Spring websocket配置"></a>Spring websocket配置</h3><h4 id="1-WebSocketConfigurer_u8BBE_u7F6E"><a href="#1-WebSocketConfigurer_u8BBE_u7F6E" class="headerlink" title="1.WebSocketConfigurer设置"></a>1.WebSocketConfigurer设置</h4><p>注册Spring WebSocket服务</p>
<blockquote>
<p>其中registerWebSocketHandlers方法：<br>registry.addHandler(systemWebSocketHandler(),”xxx”);<br>xxx填写准备使用的WebSocket服务器请求地址，本项目中以 webSocketServer.do 为例</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tx.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.EnableWebMvc;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.WebSocketHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.client.standard.WebSocketContainerFactoryBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.config.annotation.EnableWebSocket;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.config.annotation.WebSocketConfigurer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.config.annotation.WebSocketHandlerRegistry;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.tx.handler.SystemWebSocketHandler;</span><br><span class="line"></span><br><span class="line"><span class="annotation">@Configuration</span></span><br><span class="line"><span class="annotation">@EnableWebMvc</span></span><br><span class="line"><span class="annotation">@EnableWebSocket</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebSocketConfig</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurerAdapter</span> <span class="keyword">implements</span> <span class="title">WebSocketConfigurer</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerWebSocketHandlers</span><span class="params">(WebSocketHandlerRegistry registry)</span> </span>&#123;</span><br><span class="line">		 registry.addHandler(systemWebSocketHandler(),<span class="string">"webSocketServer.do"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="annotation">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> WebSocketHandler <span class="title">systemWebSocketHandler</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SystemWebSocketHandler();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> WebSocketContainerFactoryBean <span class="title">createWebSocketContainer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        WebSocketContainerFactoryBean container = <span class="keyword">new</span> WebSocketContainerFactoryBean();</span><br><span class="line">        container.setMaxTextMessageBufferSize(<span class="number">8192</span>);</span><br><span class="line">        container.setMaxBinaryMessageBufferSize(<span class="number">8192</span>);</span><br><span class="line">        <span class="keyword">return</span> container;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-WebSocketHandler_u8BBE_u7F6E"><a href="#2-WebSocketHandler_u8BBE_u7F6E" class="headerlink" title="2.WebSocketHandler设置"></a>2.WebSocketHandler设置</h4><p>服务器如何处理WebSocket请求在这里面填写</p>
<blockquote>
<p>成功建立连接<br>接收到消息处理<br>处理异常<br>连接关闭后</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SystemWebSocketHandler</span> <span class="keyword">implements</span> <span class="title">WebSocketHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterConnectionEstablished</span><span class="params">(WebSocketSession session)</span></span><br><span class="line">			<span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"ConnectionEstablished"</span>);</span><br><span class="line">        <span class="comment">//TODO</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(WebSocketSession session,</span><br><span class="line">			WebSocketMessage&lt;?&gt; message)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="comment">//TODO</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleTransportError</span><span class="params">(WebSocketSession session,</span><br><span class="line">			Throwable exception)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="comment">//TODO</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterConnectionClosed</span><span class="params">(WebSocketSession session,</span><br><span class="line">			CloseStatus closeStatus)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"ConnectionClosed"</span>);</span><br><span class="line">		<span class="comment">//TODO</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supportsPartialMessages</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="u56DB_u3001_u8FD0_u884C_u7ED3_u679C"><a href="#u56DB_u3001_u8FD0_u884C_u7ED3_u679C" class="headerlink" title="四、运行结果"></a>四、运行结果</h2><h3 id="u7528_u6237_u6CE8_u518C"><a href="#u7528_u6237_u6CE8_u518C" class="headerlink" title="用户注册"></a>用户注册</h3><p>在浏览器中输入 <a href="http://localhost:8080/RealTimeChat/register.do" target="_blank" rel="external">http://localhost:8080/RealTimeChat/register.do</a><br><img src="http://i4.tietuku.com/a0938bb673d59b9as.png" alt="注册界面"><br>填写用户名及密码后，点击注册按钮<br>注册成功后，自动跳转至聊天页面</p>
<h3 id="u804A_u5929_u754C_u9762"><a href="#u804A_u5929_u754C_u9762" class="headerlink" title="聊天界面"></a>聊天界面</h3><p><img src="http://i4.tietuku.com/699c2fff12a6b0b6s.png" alt="聊天界面1"><br>顶部为当前登录用户<br>左上方为聊天室的聊天窗口<br>右上方为当前聊天室所有的在线用户<br>下方为用户的输入窗口</p>
<h3 id="u767B_u5F55_u754C_u9762"><a href="#u767B_u5F55_u754C_u9762" class="headerlink" title="登录界面"></a>登录界面</h3><p>新用户登录 <a href="http://localhost:8080/RealTimeChat/login.do" target="_blank" rel="external">http://localhost:8080/RealTimeChat/login.do</a><br><img src="http://i4.tietuku.com/1cb14a679ee4a5f1s.png" alt="登录界面"></p>
<h3 id="u591A_u4EBA_u804A_u5929"><a href="#u591A_u4EBA_u804A_u5929" class="headerlink" title="多人聊天"></a>多人聊天</h3><p>新用户加入<br><img src="http://i4.tietuku.com/7d26f7f6fce0eabds.png" alt="chat2"></p>
<h3 id="u7528_u6237_u9000_u51FA"><a href="#u7528_u6237_u9000_u51FA" class="headerlink" title="用户退出"></a>用户退出</h3><p>kyle用户退出<br><img src="http://i4.tietuku.com/036afb048ffc2515s.png" alt="logout"></p>
<h4 id="u4E94_u3001_u9879_u76EE_u4EE3_u7801"><a href="#u4E94_u3001_u9879_u76EE_u4EE3_u7801" class="headerlink" title="五、项目代码"></a>五、项目代码</h4><p><a href="https://github.com/zhangtianle/WebSocketChat" target="_blank" rel="external">github项目地址</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mybatis/">mybatis</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/spring/">spring</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/websocket/">websocket</a></li></ul>
	</div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











    
        <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
        <script>
        var yiliaConfig = {
        fancybox: true,
        mathjax: true,
        animate: true,
        isHome: true,
        isPost: false,
        isArchive: false,
        isTag: false,
        isCategory: false,
        open_in_new: false
        }
        </script>
     

  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/12/16/hello-world/" class="article-date">
  	<time datetime="2015-12-16T11:52:30.205Z" itemprop="datePublished">2015-12-16</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/16/hello-world/">Hello World</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>Hello World！</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











    
        <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
        <script>
        var yiliaConfig = {
        fancybox: true,
        mathjax: true,
        animate: true,
        isHome: true,
        isPost: false,
        isArchive: false,
        isTag: false,
        isCategory: false,
        open_in_new: false
        }
        </script>
     

  
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">
        &copy; 2015 Tianle Zhang
      </div>
        <div class="footer-right">
          <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的静态博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减双栏 Hexo 博客主题">Yelee</a> by MOxFIVE
        </div>
    </div>
    <div class="visit">
      <span id="busuanzi_container_site_pv" style='display:none'>
        <span id="site-visit" >本站到访数: 
        <span id="busuanzi_value_site_uv"></span>
        </span>
      </span>
      <span id="busuanzi_container_page_pv" style='display:none'>
        <span id="page-visit">, 本页阅读量: 
        <span id="busuanzi_value_page_pv"></span>
        </span>
      </span>
    </div>
  </div>
</footer>
    </div>
    
	<script>
		var yiliaConfig = {
			fancybox: false,
			mathjax: true,
			animate: true,
			isHome: true,
			isPost: false,
			isArchive: false,
			isTag: false,
			isCategory: false,
			open_in_new: false
		}
	</script>


<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>

<script>
  var backgroundnum = 5;
  var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));

  $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
</script>




<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<div class="scroll" id="scroll">
<a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
<a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>